"use strict";(self.webpackChunkfaltai=self.webpackChunkfaltai||[]).push([[317],{317:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var s=t(43),r=t(189),l=(t(97),t(204)),o=t(698),i=t(628);var n=t(579);const d=function(e){let{setModalOpen:a}=e;const{adicionarMateria:t}=(0,o.Y)(),{addError:d,addSuccess:c}=(0,i.q)(),[m,x]=(0,s.useState)(""),[p,u]=(0,s.useState)(""),[h,v]=(0,s.useState)("1"),[b,j]=(0,s.useState)([]),[f,g]=(0,s.useState)({tipo:"",data:"",descricao:""}),[N,y]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1);return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-[10001] p-0 sm:p-4",children:(0,n.jsxs)("div",{className:"bg-white w-full sm:max-w-md max-h-[90vh] overflow-y-auto rounded-t-2xl sm:rounded-lg shadow-2xl",children:[(0,n.jsxs)("div",{className:"sticky top-0 bg-white z-10 border-b",children:[(0,n.jsx)("div",{className:"sm:hidden flex justify-center pt-2 pb-1",children:(0,n.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),(0,n.jsxs)("div",{className:"flex justify-between items-center px-4 sm:px-6 py-3",children:[(0,n.jsx)("h2",{className:"text-base sm:text-xl font-semibold text-gray-800",children:"Nova Mat\xe9ria"}),(0,n.jsx)("button",{onClick:()=>a(!1),className:"text-gray-500 hover:text-gray-700 p-2 rounded-lg","aria-label":"Fechar",children:(0,n.jsx)(l.QCr,{})})]})]}),(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!m||!p)return void d("Nome e carga hor\xe1ria s\xe3o obrigat\xf3rios");const s=(e=>{const a={};e.nome&&e.nome.trim()?e.nome.trim().length<2?a.nome="Nome deve ter pelo menos 2 caracteres":e.nome.trim().length>50&&(a.nome="Nome deve ter no m\xe1ximo 50 caracteres"):a.nome="Nome da mat\xe9ria \xe9 obrigat\xf3rio";const t=parseInt(e.horas);!e.horas||isNaN(t)?a.horas="Carga hor\xe1ria \xe9 obrigat\xf3ria":(t<15||t>200)&&(a.horas="Carga hor\xe1ria deve estar entre 15 e 200 horas");const s=parseFloat(e.pesoFalta);return!e.pesoFalta||isNaN(s)?a.pesoFalta="Peso da falta \xe9 obrigat\xf3rio":s<=0?a.pesoFalta="Peso da falta deve ser maior que zero":s>10&&(a.pesoFalta="Peso da falta deve ser no m\xe1ximo 10"),{isValid:0===Object.keys(a).length,errors:a}})({nome:m,horas:p,pesoFalta:h});if(s.isValid)try{const e=Math.floor(.25*parseInt(p)/parseInt(h)),s=(e=>{var a;return{nome:(null===(a=e.nome)||void 0===a?void 0:a.trim())||"",horas:parseInt(e.horas)||0,pesoFalta:parseFloat(e.pesoFalta)||1,avaliacoes:e.avaliacoes||[],faltas:e.faltas||0,maxFaltas:Math.floor(.25*(parseInt(e.horas)||0)),id:e.id||Date.now()}})({nome:m.trim(),horas:parseInt(p),pesoFalta:parseInt(h),maxFaltas:e,faltas:0,datasFaltas:[],avaliacoes:b});await t(s),c("Mat\xe9ria adicionada com sucesso!"),a(!1)}catch(r){d("Erro ao adicionar mat\xe9ria")}else{const e=Object.values(s.errors).join(", ");d(`Erro: ${e}`)}},className:"space-y-4 px-4 sm:px-6 py-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Mat\xe9ria"}),(0,n.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border rounded-md text-sm",placeholder:"Ex: C\xe1lculo 1",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Carga Hor\xe1ria"}),(0,n.jsxs)("select",{value:p,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border rounded-md text-sm",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Selecione"}),(0,n.jsx)("option",{value:"30",children:"30 horas"}),(0,n.jsx)("option",{value:"45",children:"45 horas"}),(0,n.jsx)("option",{value:"60",children:"60 horas"}),(0,n.jsx)("option",{value:"75",children:"75 horas"}),(0,n.jsx)("option",{value:"90",children:"90 horas"}),(0,n.jsx)("option",{value:"120",children:"120 horas"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso da Falta"}),(0,n.jsxs)("select",{value:h,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border rounded-md text-sm",children:[(0,n.jsx)("option",{value:"1",children:"1 falta por vez"}),(0,n.jsx)("option",{value:"2",children:"2 faltas por vez"}),(0,n.jsx)("option",{value:"4",children:"4 faltas por vez"})]})]}),(0,n.jsx)("div",{className:"border-t pt-4",children:(0,n.jsxs)("button",{type:"button",onClick:()=>y(!N),className:"text-blue-600 hover:text-blue-700 text-sm flex items-center",children:[(0,n.jsx)(l.OiG,{className:"mr-1"})," ",N?"Ocultar Avalia\xe7\xf5es":"Adicionar Avalia\xe7\xf5es"]})}),N&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,n.jsx)("input",{type:"text",value:f.tipo,onChange:e=>g((a=>({...a,tipo:e.target.value}))),className:"w-full sm:flex-1 min-w-0 px-3 py-2 border rounded-md text-sm",placeholder:"Tipo (ex: Prova, Trabalho, Semin\xe1rio)",required:!0}),(0,n.jsx)("button",{type:"button",onClick:()=>C(!w),className:"w-full sm:w-[180px] px-3 py-2 border rounded-md text-sm text-left hover:bg-gray-50 transition-colors",children:f.data?new Date(f.data+"T00:00:00").toLocaleDateString("pt-BR"):"Selecionar data"})]}),w&&(0,n.jsx)("div",{className:"border rounded-lg p-3 bg-gray-50",children:(0,n.jsx)(r.Ay,{onChange:e=>{g((a=>({...a,data:e.toISOString().split("T")[0]}))),C(!1)},value:f.data?new Date(f.data+"T00:00:00"):new Date,locale:"pt-BR",minDetail:"month",next2Label:null,prev2Label:null,navigationLabel:e=>{let{date:a}=e;const t=a.toLocaleString("pt-BR",{month:"long"}),s=a.toLocaleString("pt-BR",{year:"numeric"});return(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2 min-w-0",title:`${t} ${s}`,children:[(0,n.jsx)("span",{className:"truncate text-sm font-semibold capitalize",children:t}),(0,n.jsx)("span",{className:"shrink-0 text-sm font-semibold",children:s})]})},className:"border-none w-full"})}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,n.jsx)("input",{type:"text",value:f.descricao,onChange:e=>g((a=>({...a,descricao:e.target.value}))),className:"w-full sm:flex-1 min-w-0 px-3 py-2 border rounded-md text-sm",placeholder:"Descri\xe7\xe3o (opcional)"}),(0,n.jsx)("button",{type:"button",onClick:()=>{f.tipo&&f.data?(j((e=>[...e,{...f,id:Date.now()}])),g({tipo:"",data:"",descricao:""}),c("Avalia\xe7\xe3o adicionada!")):d("Tipo e data s\xe3o obrigat\xf3rios para a avalia\xe7\xe3o")},className:"w-full sm:w-auto px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",children:"Adicionar"})]})]}),(0,n.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-1",children:b.map((e=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded-md gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 min-w-0",children:["PROVA"===e.tipo?(0,n.jsx)(l.aZA,{className:"text-red-500"}):(0,n.jsx)(l.vd0,{className:"text-red-500"}),(0,n.jsxs)("div",{className:"min-w-0",children:[(0,n.jsx)("p",{className:"text-xs sm:text-sm font-medium",children:new Date(e.data).toLocaleDateString("pt-BR")}),e.descricao&&(0,n.jsx)("p",{className:"text-xs text-gray-500 break-words",children:e.descricao})]})]}),(0,n.jsx)("button",{type:"button",onClick:()=>{return a=e.id,void j((e=>e.filter((e=>e.id!==a))));var a},className:"text-gray-400 hover:text-red-500 shrink-0",children:(0,n.jsx)(l.QCr,{})})]},e.id)))})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>a(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancelar"}),(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Adicionar"})]})]})]})})}}}]);
//# sourceMappingURL=317.b8b8b49e.chunk.js.map