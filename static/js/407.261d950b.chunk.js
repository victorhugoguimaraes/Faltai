"use strict";(self.webpackChunkfaltai=self.webpackChunkfaltai||[]).push([[407],{407:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var s=a(43),r=a(204),i=a(823),l=a(579);const n=function(e){let{isOpen:t,onClose:a}=e;const[n,c]=(0,s.useState)([]);(0,s.useEffect)((()=>{t&&o()}),[t]);const o=()=>{const e=i.A.getScheduledNotifications();c(e)},d=e=>"weekly"===e.type?(0,l.jsx)(r.bfZ,{className:"text-blue-500"}):(0,l.jsx)(r.jNV,{className:"text-orange-500"});return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[80vh] flex flex-col",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,l.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[(0,l.jsx)(r.w_X,{className:"text-blue-600"}),"Notifica\xe7\xf5es Agendadas"]}),(0,l.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)(r.QCr,{})})]}),(0,l.jsx)("div",{className:"overflow-y-auto flex-1",children:0===n.length?(0,l.jsxs)("div",{className:"p-6 text-center",children:[(0,l.jsx)(r.w_X,{className:"mx-auto text-4xl text-gray-300 mb-3"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Nenhuma notifica\xe7\xe3o agendada"}),(0,l.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Adicione avalia\xe7\xf5es para receber lembretes autom\xe1ticos!"})]}):(0,l.jsx)("div",{className:"divide-y",children:n.map((e=>{return(0,l.jsxs)("div",{className:"p-4 hover:bg-gray-50 flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[d(e),(0,l.jsx)("h3",{className:"font-medium text-gray-800 text-sm",children:e.title})]}),(0,l.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.message}),(0,l.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[(0,l.jsx)(r.w_X,{}),(0,l.jsx)("span",{children:(t=e.scheduledTime,new Date(t).toLocaleDateString("pt-BR",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),"evaluation"===e.type&&(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsxs)("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[e.daysAhead," dia",1===e.daysAhead?"":"s"," antes"]})}),"weekly"===e.type&&(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)("span",{className:"inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Lembrete Semanal"})})]}),"weekly"!==e.type&&(0,l.jsx)("button",{onClick:()=>{return t=e.id,i.A.removeScheduledNotification(t),void o();var t},className:"text-gray-400 hover:text-red-600 p-1",title:"Cancelar notifica\xe7\xe3o",children:(0,l.jsx)(r.QCr,{className:"text-sm"})})]},e.id);var t}))})}),(0,l.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,l.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,l.jsx)("p",{children:"\u2022 Avalia\xe7\xf5es: lembretes 7, 3 e 1 dia antes"}),(0,l.jsx)("p",{children:"\u2022 S\xe1bados 13h: lembrete para marcar faltas"}),(0,l.jsx)("p",{children:"\u2022 Notifica\xe7\xf5es aparecem mesmo com app fechado"})]})})]})}):null},c=(0,s.forwardRef)(((e,t)=>{let{materias:a}=e;const[i,c]=(0,s.useState)([]),[o,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1),[p,u]=(0,s.useState)(!1),[g,b]=(0,s.useState)({evaluationReminders:!0,weeklyReminders:!0,attendanceAlerts:!0,systemNotifications:!0});(0,s.useEffect)((()=>{const e=localStorage.getItem("notification_settings");if(e)try{b(JSON.parse(e))}catch(t){console.error("Erro ao carregar configura\xe7\xf5es:",t)}"Notification"in window&&("granted"===Notification.permission?x(!0):"denied"!==Notification.permission&&Notification.requestPermission().then((e=>{x("granted"===e)})))}),[]);const N=e=>{b(e),localStorage.setItem("notification_settings",JSON.stringify(e))};(0,s.useImperativeHandle)(t,(()=>({addNotification:e=>{const t=`${e.tipo}-${e.mensagem}`;c((a=>{if(!a.some((e=>e.id===t))){const s={id:t,...e,timestamp:new Date},r=[s,...a];return localStorage.setItem("app_notifications",JSON.stringify(r)),!document.hidden&&document.hasFocus()||(e=>{if(m&&"Notification"in window&&g.systemNotifications){const t=new Notification(e.titulo,{body:e.mensagem,icon:"/icon-192.png",tag:e.id,requireInteraction:!1,silent:!1});setTimeout((()=>t.close()),5e3)}})(s),r}return a}))}})));const j=e=>{const t=Math.floor((new Date-e)/1e3),a={ano:31536e3,"m\xeas":2592e3,semana:604800,dia:86400,hora:3600,minuto:60};for(const[s,r]of Object.entries(a)){const e=Math.floor(t/r);if(e>=1)return`h\xe1 ${e} ${s}${e>1?"m\xeas"===s?"es":"s":""}`}return"agora mesmo"};return(0,s.useEffect)((()=>{const e=localStorage.getItem("app_notifications");if(e)try{const t=JSON.parse(e),a=new Date(Date.now()-6048e5),s=t.filter((e=>new Date(e.timestamp)>a));c(s),s.length!==t.length&&localStorage.setItem("app_notifications",JSON.stringify(s))}catch(s){console.error("Erro ao carregar notifica\xe7\xf5es:",s)}const t=new Date;(a||[]).flatMap((e=>(e.avaliacoes||[]).map((t=>({...t,materia:e.nome,data:new Date(t.data)}))))).filter((e=>e.data>=t)).sort(((e,t)=>e.data-t.data)).forEach((e=>{const a=Math.ceil((e.data-t)/864e5),s=`${e.id}-${e.data}`;let r="";if(0===a)r=`Hoje tem ${"PROVA"===e.tipo?"prova":"trabalho"} de ${e.materia}`;else if(1===a)r=`Amanh\xe3 tem ${"PROVA"===e.tipo?"prova":"trabalho"} de ${e.materia}`;else if(a<=7)r=`Daqui a ${a} dias tem ${"PROVA"===e.tipo?"prova":"trabalho"} de ${e.materia}`;else if(a<=14){const t=Math.ceil(a/7);r=`Daqui a ${t} semana${t>1?"s":""} tem ${"PROVA"===e.tipo?"prova":"trabalho"} de ${e.materia}`}if(r){const t={id:s,titulo:"PROVA"===e.tipo?"\ud83d\udcdd Prova Pr\xf3xima":"\ud83d\udcda Trabalho Pr\xf3ximo",mensagem:r,tipo:"info",timestamp:new Date,avaliacao:!0};c((e=>{if(!e.some((e=>e.id===s))){const a=[t,...e];return localStorage.setItem("app_notifications",JSON.stringify(a)),a}return e}))}})),(a||[]).forEach((e=>{if(e.faltas>=e.maxFaltas){const t=`max-faltas-${e.nome}`,a={id:t,titulo:"\u26a0\ufe0f Limite de Faltas",mensagem:`Voc\xea atingiu o limite de faltas em ${e.nome}`,tipo:"alerta",timestamp:new Date};c((e=>{if(!e.some((e=>e.id===t))){const t=[a,...e];return localStorage.setItem("app_notifications",JSON.stringify(t)),t}return e}))}}))}),[a]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{onClick:()=>d(!0),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full p-3 sm:p-4 shadow-2xl hover:bg-blue-700 transition-all z-[9999] hover:scale-110 active:scale-95",style:{touchAction:"manipulation"},"aria-label":"Abrir notifica\xe7\xf5es",children:[(0,l.jsx)(r.jNV,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i.length>0&&(0,l.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center animate-pulse",children:i.length>99?"99+":i.length})]}),o&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[10000] p-0 sm:p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-t-3xl sm:rounded-lg w-full sm:max-w-md max-h-[90vh] sm:max-h-[80vh] flex flex-col shadow-2xl",children:[(0,l.jsx)("div",{className:"sm:hidden flex justify-center pt-2 pb-1",children:(0,l.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 sm:p-4 border-b sticky top-0 bg-white z-10",children:[(0,l.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"Notifica\xe7\xf5es"}),(0,l.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,l.jsx)("button",{onClick:()=>u(!0),className:"text-gray-600 hover:text-blue-600 p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Configura\xe7\xf5es de notifica\xe7\xf5es",children:(0,l.jsx)(r.Pcn,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:()=>h(!0),className:"text-blue-600 hover:text-blue-800 p-2 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver notifica\xe7\xf5es agendadas",children:(0,l.jsx)(r.w_X,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,l.jsx)(r.QCr,{className:"w-5 h-5"})})]})]}),"            ",(0,l.jsx)("div",{className:"overflow-y-auto flex-1",children:0===i.length?(0,l.jsx)("p",{className:"text-gray-500 text-center p-8 sm:p-12",children:"Nenhuma notifica\xe7\xe3o"}):(0,l.jsx)("div",{className:"divide-y",children:i.map((e=>(0,l.jsxs)("div",{className:"p-3 sm:p-4 hover:bg-gray-50 active:bg-gray-100 flex items-start justify-between gap-2 sm:gap-4",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e.avaliacao?e.titulo.includes("Prova")?(0,l.jsx)(r.aZA,{className:"text-red-500 w-4 h-4"}):(0,l.jsx)(r.vd0,{className:"text-red-500 w-4 h-4"}):(0,l.jsx)(r.jNV,{className:"w-4 h-4 "+("sucesso"===e.tipo?"text-green-500":"alerta"===e.tipo?"text-yellow-500":"text-blue-500")}),(0,l.jsx)("h3",{className:"font-medium text-gray-800 text-sm sm:text-base",children:e.titulo})]}),(0,l.jsx)("p",{className:"text-gray-600 text-sm sm:text-base mt-1",children:e.mensagem}),(0,l.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:j(e.timestamp)})]}),(0,l.jsx)("button",{onClick:()=>{return t=e.id,void c((e=>{const a=e.filter((e=>e.id!==t));return localStorage.setItem("app_notifications",JSON.stringify(a)),a}));var t},className:"text-gray-400 hover:text-gray-600 p-1 hover:bg-gray-200 rounded",children:(0,l.jsx)(r.QCr,{className:"w-4 h-4"})})]},e.id)))})})]})}),(0,l.jsx)(n,{isOpen:f,onClose:()=>h(!1)}),p&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[10001] p-0 sm:p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-t-3xl sm:rounded-lg w-full sm:max-w-md max-h-[90vh] overflow-y-auto",children:[(0,l.jsx)("div",{className:"sm:hidden flex justify-center pt-2 pb-1 sticky top-0 bg-white z-10",children:(0,l.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 sm:p-4 border-b sticky top-4 sm:top-0 bg-white z-10",children:[(0,l.jsxs)("h2",{className:"text-base sm:text-lg font-semibold text-gray-800 flex items-center gap-2",children:[(0,l.jsx)(r.Pcn,{className:"text-blue-600 w-4 h-4 sm:w-5 sm:h-5"}),"Configura\xe7\xf5es de Notifica\xe7\xf5es"]}),(0,l.jsx)("button",{onClick:()=>u(!1),className:"text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-lg",children:(0,l.jsx)(r.QCr,{className:"w-5 h-5"})})]}),(0,l.jsxs)("div",{className:"p-3 sm:p-4 space-y-4 pb-6",children:[(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-800 text-sm sm:text-base",children:"Lembretes de Avalia\xe7\xf5es"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"Notifica\xe7\xf5es 7, 3 e 1 dia antes"})]}),(0,l.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:g.evaluationReminders,onChange:e=>N({...g,evaluationReminders:e.target.checked}),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-800 text-sm sm:text-base",children:"Lembrete Semanal"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"Todo s\xe1bado \xe0s 13h para marcar faltas"})]}),(0,l.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:g.weeklyReminders,onChange:e=>N({...g,weeklyReminders:e.target.checked}),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-800 text-sm sm:text-base",children:"Alertas de Presen\xe7a"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"Quando atingir limite de faltas"})]}),(0,l.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:g.attendanceAlerts,onChange:e=>N({...g,attendanceAlerts:e.target.checked}),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-800 text-sm sm:text-base",children:"Notifica\xe7\xf5es do Sistema"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"Notifica\xe7\xf5es push quando app fechado"})]}),(0,l.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:g.systemNotifications,onChange:e=>N({...g,systemNotifications:e.target.checked}),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]}),(0,l.jsx)("div",{className:"pt-3 sm:pt-4 border-t",children:(0,l.jsxs)("div",{className:"text-xs text-gray-600 space-y-1 leading-relaxed",children:[(0,l.jsx)("p",{children:"\u2022 As configura\xe7\xf5es s\xe3o salvas automaticamente"}),(0,l.jsx)("p",{children:"\u2022 Notifica\xe7\xf5es do sistema requerem permiss\xe3o do navegador"}),(0,l.jsx)("p",{children:"\u2022 Altera\xe7\xf5es afetam apenas novas notifica\xe7\xf5es"})]})})]})]})})]})}))}}]);
//# sourceMappingURL=407.261d950b.chunk.js.map